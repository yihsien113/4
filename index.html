<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¥é¾è¨˜ç‰Œå°å·¥å…· (å¾©åŸ/åå¾©åŸåŠŸèƒ½ - ç²¾ç°¡ç‰ˆ)</title>
  <style>
    /* ========== æ·±è‰²æ¨¡å¼åŸºç¤è¨­å®š ========== */
    body { 
      font-family: 'Microsoft JhengHei', Arial, sans-serif; 
      text-align: center; 
      background: #282c34; /* æ·±è—ç°è‰²èƒŒæ™¯ */
      color: #f0f0f0; /* æ·ºç°è‰²æ–‡å­— */
      font-size: 18px; 
      margin: 15px;
    }
    
    h2 {
      color: #61dafb; /* äº®è—è‰²æ¨™é¡Œ */
      margin-bottom: 15px;
    }
    
    /* é ‚éƒ¨æ§åˆ¶å€ï¼šç”¨æ–¼ä¸¦æ’å°é½Šã€Œå…¨éƒ¨æ¸…é™¤ã€å’Œã€Œé¸æ“‡å€ã€ */
    .top-selection {
        display: flex;
        justify-content: space-between; 
        align-items: center; 
        max-width: 650px; 
        margin: 10px auto;
    }

    /* èª¿æ•´é¸æ“‡å€åŸŸï¼Œä¸å†éœ€è¦å›ºå®šå¯¬åº¦ */
    .selection-area {
        display: flex;
        align-items: center; 
        width: auto; 
        justify-content: flex-end; 
    }

    /* ========== é€šç”¨æŒ‰éˆ•æ¨£å¼ ========== */
    button { 
      font-size: 20px;  
      margin: 4px; 
      padding: 8px 12px; 
      border-radius: 6px; 
      cursor: pointer;
      border: 1px solid #555; 
      background: #3a3f47; 
      color: #f0f0f0;
      min-width: 40px; 
      transition: background-color 0.2s;
      /* *** ä¿®æ­£é›™æ“Šç¸®æ”¾å•é¡Œï¼šæ–°å¢æ­¤è¡Œ *** */
      touch-action: manipulation;
    }
    
    button:hover {
      background-color: #4c525d; 
    }

    /* ç´…è‰²èŠ±è‰²æ–‡å­— (åªæœ‰æ–‡å­—è®Šè‰²) */
    .red-text-suit {
        color: #e74c3c !important; 
    }


    /* ========== å·¦å´ï¼šå…¨éƒ¨æ¸…é™¤æŒ‰éˆ• ========== */
    .clear-all { 
      background: #e74c3c; 
      box-shadow: 0 3px 0 #c0392b;
      width: 100px; 
      margin-right: 0; 
      font-size: 16px; 
      padding: 6px 8px; 
      flex-direction: row; 
      justify-content: center;
      flex-shrink: 0; 
    }
    .clear-all .clear-icon {
        font-size: 18px; 
        margin-right: 3px;
        margin-bottom: 0;
    }
    .clear-all:hover {
      background: #c0392b;
      transform: translateY(1px);
      box-shadow: 0 2px 0 #a03020;
    }


    /* ========== é¸æ“‡å€åŸŸå…§å…ƒä»¶æ¨£å¼ ========== */

    /* èŠ±è‰²æŒ‰éˆ•å®¹å™¨ (2x2) */
    .suit-group {
      display: grid;
      grid-template-columns: repeat(2, auto);
      gap: 1px; 
      margin-right: 8px; 
    }
    
    /* èŠ±è‰²æŒ‰éˆ•åŠ å¤§ */
    .suit-group button {
        padding: 10px 10px; 
        font-size: 22px;
        min-width: 50px;
    }

    /* æ•¸å­—æŒ‰éˆ•å®¹å™¨ (A-6, 7-K) */
    .rank-group {
      display: flex;
      flex-direction: column;
    }

    /* æ•¸å­—æŒ‰éˆ•çš„æ¯ä¸€è¡Œ */
    .rank-row { 
      display: flex;
      flex-wrap: nowrap;
      justify-content: flex-start;
      margin: 0;
      padding: 0;
    }

    /* ========== è¨˜ç‰Œå€ç¸½å®¹å™¨ & å´é‚Šæ¬„ ========== */
    .main-area {
      display: flex;
      justify-content: center;
      align-items: flex-start; 
      margin: 10px auto;
      max-width: 650px; 
    }
    
    /* å·¦å´æ¸…é™¤/å¾©åŸæŒ‰éˆ•å€ */
    .sidebar-buttons {
      display: flex;
      flex-direction: column; 
      width: 90px; /* ç¸®å°å¯¬åº¦ */
      margin-right: 30px; 
      padding-top: 5px; 
    }
    
    /* ========== è¨˜ç‰Œæ§½ç¶²æ ¼ & è¨˜ç‰Œæ§½æ¨£å¼ (68px å°ºå¯¸) ========== */
    .grid { 
      display: grid; 
      grid-template-columns: repeat(6, 68px); /* æ§½ä½å¯¬åº¦ 68px */
      gap: 5px; 
      justify-content: center; 
      max-width: 510px; 
      padding: 5px;
      background: #3a3f47;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5); 
    }
    
    .slot { 
      width: 68px;  /* æ§½ä½å¯¬åº¦ 68px */
      height: 50px; 
      font-size: 24px;  
      border: 3px solid #555; 
      border-radius: 8px;
      background: #1e1e1e;
      color: #f0f0f0; 
      margin: 0; 
      display: flex; 
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* ç¢ºä¿ç´…è‰²çš„èŠ±è‰² (â™¥, â™¦) åœ¨æ·±è‰²èƒŒæ™¯ä¸‹ä¿æŒç´…è‰² (æ­¤ç‚ºæ§½ä½å…§å®¹) */
    .slot[style*="color: red"] {
        color: #ff6b6b !important; 
    }

    /* ========== å´é‚Šæ¸…é™¤æŒ‰éˆ•æ¨£å¼ (é€šç”¨) - ç¸®å°èª¿æ•´ ========== */
    .clear-button { 
      font-size: 16px; /* ç¸®å°æ–‡å­— */
      padding: 8px 8px; /* ç¸®å°å…§é‚Šè· */
      margin: 5px 0;
      border-radius: 6px;
      color: white; 
      border: none;
      width: 90px; /* ç¸®å°å¯¬åº¦ */
      display: flex;
      flex-direction: column; 
      align-items: center;
    }

    .clear-icon {
      font-size: 24px; /* ç¸®å°åœ–æ¨™ */
      margin-bottom: 2px; /* å¾®èª¿é–“è· */
    }
    
    /* æ¸…é™¤ç©ºæ ¼æŒ‰éˆ• (ç¶ è‰²) */
    .clear-empty { 
      background: #2ecc71; 
      box-shadow: 0 3px 0 #27ae60;
    }
    .clear-empty:hover {
      background: #27ae60;
      transform: translateY(1px);
      box-shadow: 0 2px 0 #219d55;
    }

    /* å¾©åŸæŒ‰éˆ• (è—è‰²) */
    .undo-button {
        background: #3498db; 
        box-shadow: 0 3px 0 #2980b9;
    }
    .undo-button:hover {
        background: #2980b9;
        transform: translateY(1px);
        box-shadow: 0 2px 0 #2071a1;
    }
    
    /* åå¾©åŸæŒ‰éˆ• (è—ç¶ è‰²) */
    .redo-button {
        background: #1abc9c; 
        box-shadow: 0 3px 0 #16a085;
    }
    .redo-button:hover {
        background: #16a085;
        transform: translateY(1px);
        box-shadow: 0 2px 0 #148f77;
    }

  </style>
</head>
<body>

  <h2>æ¥é¾è¨˜ç‰Œå°å·¥å…· (æœ€å¤§è¨˜æ†¶ï¼š200 æ­¥)</h2>

  <div class="top-selection">
      
      <button class="clear-all" onclick="clearAll()">
          <span class="clear-icon">âŒ</span>
          å…¨éƒ¨æ¸…é™¤
      </button>

      <div class="selection-area">
          
          <div class="suit-group">
              <button onclick="selectSuit('â™£')">â™£</button>
              <button class="red-text-suit" onclick="selectSuit('â™¦')">â™¦</button>
              <button class="red-text-suit" onclick="selectSuit('â™¥')">â™¥</button>
              <button onclick="selectSuit('â™ ')">â™ </button>
          </div>

          <div class="rank-group">
              <div class="rank-row">
                  <button onclick="selectRank('A')">A</button>
                  <button onclick="selectRank('2')">2</button>
                  <button onclick="selectRank('3')">3</button>
                  <button onclick="selectRank('4')">4</button>
                  <button onclick="selectRank('5')">5</button>
                  <button onclick="selectRank('6')">6</button>
              </div>
              <div class="rank-row">
                  <button onclick="selectRank('7')">7</button>
                  <button onclick="selectRank('8')">8</button>
                  <button onclick="selectRank('9')">9</button>
                  <button onclick="selectRank('10')">10</button>
                  <button onclick="selectRank('J')">J</button>
                  <button onclick="selectRank('Q')">Q</button>
                  <button onclick="selectRank('K')">K</button>
              </div>
          </div>
      </div>
  </div>
  
  <div class="main-area">
      <div class="sidebar-buttons">
          
          <button class="clear-button clear-empty" onclick="removeEmptySlots()">
              <span class="clear-icon">ğŸ—‘ï¸</span>
              æ¸…é™¤ç©ºæ ¼
          </button>
          
          <button class="clear-button undo-button" onclick="undo()">
              <span class="clear-icon">â†¶</span>
              å¾©åŸ
          </button>
          
          <button class="clear-button redo-button" onclick="redo()">
              <span class="clear-icon">â†±</span>
              åå¾©åŸ
          </button>

      </div>
      
      <div class="grid" id="slots"></div>
  </div>


  <script>
    let selectedSuit = '';
    let selectedRank = '';
    
    // ========== å¾©åŸ/åå¾©åŸåŠŸèƒ½æ ¸å¿ƒè®Šæ•¸èˆ‡å‡½æ•¸ ==========
    let history = [];
    let redoStack = []; // ç”¨æ–¼åå¾©åŸçš„å †ç–Š
    const MAX_HISTORY = 200; // ***å·²èª¿æ•´ç‚º 200 å€‹æ­¥é©Ÿ***

    function getCurrentState() {
        const slots = document.querySelectorAll('.slot');
        return Array.from(slots).map(s => {
            return {
                content: s.innerText,
                color: s.style.color
            };
        });
    }

    function loadState(state) {
        const slots = document.querySelectorAll('.slot');
        if (state.length !== slots.length) return; 

        slots.forEach((s, index) => {
            const item = state[index];
            s.innerText = item.content;
            s.style.color = item.color || '#f0f0f0'; 
        });
    }

    function saveState() {
        const currentState = getCurrentState();
        
        // æª¢æŸ¥æ˜¯å¦èˆ‡æœ€å¾Œä¸€å€‹æ­·å²ç‹€æ…‹ç›¸åŒï¼Œé˜²æ­¢é‡è¤‡å„²å­˜
        if (history.length > 0) {
            const lastState = history[history.length - 1];
            if (JSON.stringify(lastState) === JSON.stringify(currentState)) {
                return; 
            }
        }

        // é™åˆ¶æ­·å²è¨˜éŒ„æ•¸é‡
        if (history.length >= MAX_HISTORY) {
            history.shift(); // åˆªé™¤æœ€èˆŠçš„ç‹€æ…‹
        }
        history.push(currentState);
    }

    /**
     * å¾©åŸä¸Šä¸€å€‹å‹•ä½œ (è¼‰å…¥ä¸Šä¸€å€‹å„²å­˜çš„ç‹€æ…‹)
     */
    function undo() {
        // å¦‚æœæ­·å²è¨˜éŒ„å°‘æ–¼æˆ–ç­‰æ–¼ 1 (åªå‰©ä¸‹åˆå§‹ç‹€æ…‹)ï¼Œå‰‡ä¸èƒ½å¾©åŸ
        if (history.length <= 1) {
            return;
        }
        
        // 1. å„²å­˜ç•¶å‰ç‹€æ…‹åˆ° Redo å †ç–Š
        const currentState = history.pop(); 
        redoStack.push(currentState);
        
        // 2. è¼‰å…¥æ–°çš„ã€Œæœ€æ–°ã€ç‹€æ…‹ (å³ä¸Šä¸€æ­¥æ“ä½œå‰çš„ç‹€æ…‹)
        const previousState = history[history.length - 1];
        loadState(previousState);
    }

    /**
     * åå¾©åŸ (é‡åš) ä¸Šä¸€å€‹è¢«å¾©åŸçš„å‹•ä½œ
     */
    function redo() {
        // Redo å †ç–Šç‚ºç©ºæ™‚ï¼Œä¸èƒ½åå¾©åŸ
        if (redoStack.length === 0) {
            return;
        }

        // 1. å¾ Redo å †ç–Šå–å‡ºç‹€æ…‹
        const nextState = redoStack.pop();
        
        // 2. è¼‰å…¥è©²ç‹€æ…‹
        loadState(nextState);

        // 3. å°‡è©²ç‹€æ…‹é‡æ–°æ¨å› History é™£åˆ—
        history.push(nextState);
    }
    // ========== å¾©åŸ/åå¾©åŸåŠŸèƒ½æ ¸å¿ƒè®Šæ•¸èˆ‡å‡½æ•¸ (çµæŸ) ==========


    // ==========================================================
    // ** é—œéµä¿®æ­£ï¼šç¢ºä¿æ‰€æœ‰å‹•ä½œåœ¨å„²å­˜æ–°ç‹€æ…‹å‰æ¸…ç©º Redo å †ç–Š **
    // ==========================================================

    function selectSuit(suit) {
      selectedSuit = suit;
    }

    function selectRank(rank) {
      selectedRank = rank;
    }

    function fillSlot(btn) {
      // ä»»ä½•æ–°å‹•ä½œå‰ï¼Œæ¸…ç©º Redo å †ç–Š
      if (redoStack.length > 0) {
          redoStack = []; 
      }

      // åŸ·è¡Œå‹•ä½œ
      if (selectedSuit && selectedRank) {
        btn.innerText = selectedSuit + selectedRank;
        btn.style.color = (selectedSuit === 'â™¥' || selectedSuit === 'â™¦') ? 'red' : '#f0f0f0'; 
        selectedSuit = '';
        selectedRank = '';
      } else if (!selectedSuit && !selectedRank) {
        btn.innerText = '';
        btn.style.color = '#f0f0f0'; 
      }
      
      // å‹•ä½œå®Œæˆå¾Œå„²å­˜ç‹€æ…‹
      saveState(); 
    }

    function clearAll() {
      // ä»»ä½•æ–°å‹•ä½œå‰ï¼Œæ¸…ç©º Redo å †ç–Š
      if (redoStack.length > 0) {
          redoStack = []; 
      }

      // åŸ·è¡Œå‹•ä½œ
      const slots = document.querySelectorAll('.slot');
      slots.forEach(s => {
        s.innerText = '';
        s.style.color = '#f0f0f0';
      });

      // å‹•ä½œå®Œæˆå¾Œå„²å­˜ç‹€æ…‹
      saveState(); 
    }

    function removeEmptySlots() {
      // ä»»ä½•æ–°å‹•ä½œå‰ï¼Œæ¸…ç©º Redo å †ç–Š
      if (redoStack.length > 0) {
          redoStack = []; 
      }

      // åŸ·è¡Œå‹•ä½œ
      const slots = Array.from(document.querySelectorAll('.slot'));
      const nonEmpty = slots.filter(s => s.innerText !== '');
      const slotsContainer = document.getElementById('slots');
      
      // æ¸…ç©ºå®¹å™¨ä¸¦é‡æ–°åŠ å…¥éç©ºå…ƒç´ 
      slotsContainer.innerHTML = '';
      nonEmpty.forEach(s => {
        slotsContainer.appendChild(s);
      });
      
      // è£œé½Šç©ºçš„æŒ‰éˆ•ï¼Œç¶­æŒ 36 å€‹æ§½ä½
      const totalSlots = 36;
      for (let i = nonEmpty.length; i < totalSlots; i++) {
        let b = document.createElement('button');
        b.className = 'slot';
        b.onclick = () => fillSlot(b);
        slotsContainer.appendChild(b);
      }
      
      // å‹•ä½œå®Œæˆå¾Œå„²å­˜ç‹€æ…‹
      saveState(); 
    }

    // åˆå§‹åŒ– 36 å€‹è¨˜ç‰Œæ§½
    const slotsContainer = document.getElementById('slots');
    for (let i = 0; i < 36; i++) {
      let b = document.createElement('button');
      b.className = 'slot';
      b.onclick = () => fillSlot(b);
      slotsContainer.appendChild(b);
    }

    // é é¢è¼‰å…¥å¾Œï¼Œå„²å­˜åˆå§‹ç‹€æ…‹
    window.onload = function() {
        saveState(); 
    }
  </script>

</body>
</html>